var EXPORTED_SYMBOLS=["StatusnetHelper"];
function StatusnetHelper(a,b,c,d){this.mAccount=a;this.mPassword=b;this.mAuthorization=btoa(a+":"+b);this.mThrobber=c;this.mServiceName=d;switch(d){case "twitter":this.mBaseURL="http://twitter.com/";break;case "identi.ca":this.mBaseURL="http://identi.ca/api/";break;case "test":this.mBaseURL="http://localhost/statusnet/index.php/api/";break;case "statusnet2":this.mBaseURL="http://192.168.1.4/statusnet/index.php/api/";break;case "statusnet":this.mBaseURL="http://10.37.3.157/statusnet/index.php/api/";break;
default:throw"StatusnetHelper: bad service string";}this.statuses._self=this;this.users._self=this;this.direct_messages._self=this;this.friendships._self=this;this.friends._self=this;this.followers._self=this;this.account._self=this;this.favorites._self=this;this.notifications._self=this;this.blocks._self=this;this.help._self=this}
StatusnetHelper.prototype._localizedError=function(a,b){var c="";switch(b){case "resp304":c="Not Modified: there was no new data to return.";break;case "resp400":c="Bad Request: your request is invalid, did you exceed the rate limit?";break;case "resp401":c="Not Authorized: either you need to provide authentication credentials, or the credentials provided aren't valid.";break;case "resp403":c="Forbidden: access denied to requested data.";break;case "resp404":c="Not Found: either you're requesting an invalid URI or the resource in question doesn't exist (ex: no such user). ";
break;case "resp500":c="Internal Server Error";break;case "resp502":c="Bad Gateway: returned if the service is down or being upgraded.";break;case "resp503":c="Service Unavailable: the servers are up, but are overloaded with requests.  Try again later.";break;case "MissingIdParameter":c="Missing id parameter";break;case "EmptyStatus":c="Cannot update with empty status";break;case "EmptyDMRecipient":c="Empty recipient for Direct Message";break;case "EmptyDMText":c="Empty text for Direct Message";break;
case "MissingUserForFriendshipTest":c="Cannot test friendship because one user parameter is missing";break;case "WrongDevice":c="Trying to update unknown device";break;case "NothingToUpdateProfileColors":c="Nothing to update, all colors are empty";break;case "CannotParseJSON":c="Cannot parse the reply recieved (as JSON)";break;case "CannotConnect":c="Cannot contact SN, is there a network connection?"}return c};
StatusnetHelper.prototype._timer=function(a,b,c,d){a.abort();this.mTimeout=null;var e;b&&(e=d._localizedError(d.mServiceName,"CannotConnect"));b(d,a,e,c)};
StatusnetHelper.prototype._onreadystatechangeStatusnet=function(a,b,c,d,e){if("4"==a.readyState)switch(a.status){case 200:this.mTimeout&&(clearTimeout(this.mTimeout),this.mTimeout=null);if(b)if(a.responseXML)b(e,a.responseXML,d);else{var f;try{f=JSON.parse?JSON.parse(a.responseText):JSON.fromString(a.responseText)}catch(g){console.log("Exception: "+g);b=e._localizedError(e.mServiceName,"CannotParseJSON");c&&c(e,a,b,d);break}b(e,f,d)}break;case 304:case 400:case 401:case 403:case 404:case 500:case 502:case 503:this.mTimeout&&
(clearTimeout(this.mTimeout),this.mTimeout=null),b=e._localizedError(e.mServiceName,"resp"+a.status),c&&c(e,a,b,d)}};StatusnetHelper.prototype._getXmlRequest=function(a,b,c,d){this.mThrobber&&this.mThrobber.removeAttribute("hidden");var e=new XMLHttpRequest,f=this;e.onreadystatechange=function(){f._onreadystatechangeStatusnet(e,b,c,d,f)};c&&(this.mTimeout=setTimeout(function(){f._timer(e,c,d,f)},1E4));e.open("GET",a,!0);e.setRequestHeader("Origin","http://localhost");return e};
StatusnetHelper.prototype._postXmlRequest=function(a,b,c,d){this.mThrobber&&this.mThrobber.removeAttribute("hidden");var e=new XMLHttpRequest,f=this;e.onreadystatechange=function(){f._onreadystatechangeStatusnet(e,b,c,d,f)};c&&(this.mTimeout=setTimeout(f._timer(e,c,d,f),1E4));e.open("POST",a,!0);e.setRequestHeader("If-Modified-Since","Sun, 1 Jan 2012 00:00:00 GMT");e.setRequestHeader("Origin","http://localhost");return e};
StatusnetHelper.prototype._sendRequest=function(a,b,c,d,e){a=this._getXmlRequest(a,b,c,e);d&&a.setRequestHeader("Authorization","Basic "+this.mAuthorization);a.send(null)};StatusnetHelper.prototype._sendPostRequest=function(a,b,c,d,e){a=this._postXmlRequest(a,b,c,e);d&&a.setRequestHeader("Authorization","Basic "+this.mAuthorization);a.setRequestHeader("Content-length",0);a.send(null)};
StatusnetHelper.prototype._addParamToQueryURL=function(a,b,c,d){c&&(a=(b?a+"&":a+"?")+(d+"="+escape(c.toString().replace(/ /g,"+"))));return a};StatusnetHelper.prototype.statuses={};StatusnetHelper.prototype.users={};StatusnetHelper.prototype.direct_messages={};StatusnetHelper.prototype.friendships={};StatusnetHelper.prototype.friends={};StatusnetHelper.prototype.followers={};StatusnetHelper.prototype.account={};StatusnetHelper.prototype.favorites={};StatusnetHelper.prototype.notifications={};
StatusnetHelper.prototype.blocks={};StatusnetHelper.prototype.help={};StatusnetHelper.prototype.statuses.friends_timeline=function(a,b,c,d,e,f,g,k){d=this._self.mBaseURL+"statuses/friends_timeline."+d;d=this._self._addParamToQueryURL(d,!1,e,"since");d=this._self._addParamToQueryURL(d,e,f,"since_id");d=this._self._addParamToQueryURL(d,e||f,g,"count");d=this._self._addParamToQueryURL(d,e||f||g,k,"page");this._self._sendRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.statuses.user_timeline=function(a,b,c,d,e,f,g,k,p){d=e?this._self.mBaseURL+"statuses/user_timeline/"+e+"."+d:this._self.mBaseURL+"statuses/user_timeline."+d;d=this._self._addParamToQueryURL(d,!1,f,"since");d=this._self._addParamToQueryURL(d,f,g,"since_id");d=this._self._addParamToQueryURL(d,f||g,k,"count");d=this._self._addParamToQueryURL(d,f||g||k,p,"page");this._self._sendRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.statuses.friends=function(a,b,c,d,e,f){d=e?this._self.mBaseURL+"statuses/friends/"+e+"."+d:this._self.mBaseURL+"statuses/friends."+d;d=this._self._addParamToQueryURL(d,!1,f,"page");this._self._sendRequest(d,a,b,!0,c)};StatusnetHelper.prototype.statuses.followers=function(a,b,c,d,e,f){d=e?this._self.mBaseURL+"statuses/followers/"+e+"."+d:this._self.mBaseURL+"statuses/followers."+d;d=this._self._addParamToQueryURL(d,!1,f,"page");this._self._sendRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.statuses.show=function(a,b,c,d,e){e?(d=this._self.mBaseURL+"statuses/show."+d,this._self._sendRequest(d+("?id="+e),a,b,!0,c)):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.statuses.replies=function(a,b,c,d,e,f,g){d=this._self.mBaseURL+"statuses/replies."+d;d=this._self._addParamToQueryURL(d,!1,e,"since");d=this._self._addParamToQueryURL(d,e,f,"since_id");d=this._self._addParamToQueryURL(d,e||f,g,"page");this._self._sendRequest(d,a,b,!0,c)};StatusnetHelper.prototype.statuses.destroy=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"statuses/destroy/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.statuses.public_timeline=function(a,b,c,d){this._self._sendRequest(this._self.mBaseURL+"statuses/public_timeline."+d,a,b,!0,c)};StatusnetHelper.prototype.statuses.search=function(a,b,c,d,e,f,g){d=this._self.mBaseURL+"search."+d;d=this._self._addParamToQueryURL(d+("?q="+e),!1,f,"since");d=this._self._addParamToQueryURL(d,f,g,"since_id");this._self._sendRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.statuses.update=function(a,b,c,d,e,f,g){e?(d=this._self.mBaseURL+"statuses/update."+d,d+="?status="+escape(e),d=this._self._addParamToQueryURL(d,!0,f,"in_reply_to_status_id"),d=this._self._addParamToQueryURL(d,!0,g,"source"),d=this._self._addParamToQueryURL(d,!0,"[[]]","annotations"),this._self._sendPostRequest(d,a,b,!0,c)):this._self._localizedError(this._self.mServiceName,"EmptyStatus")};
StatusnetHelper.prototype.statuses.aupdate=function(a,b,c,d,e,f,g,k){e?(d=this._self.mBaseURL+"statuses/update."+d,d+="?status="+escape(e),d=this._self._addParamToQueryURL(d,!0,f,"in_reply_to_status_id"),d=this._self._addParamToQueryURL(d,!0,g,"source"),d=k?this._self._addParamToQueryURL(d,!0,JSON.stringify([{custom_tssg_event:k}]),"annotations"):this._self._addParamToQueryURL(d,!0,"[[]]","annotations"),this._self._sendPostRequest(d,a,b,!0,c)):this._self._localizedError(this._self.mServiceName,"EmptyStatus")};
StatusnetHelper.prototype.users.show=function(a,b,c,d,e,f){!e&&!f?this._self._localizedError(this._self.mServiceName,"MissingIdParameter"):(f?(d=this._self.mBaseURL+"users/show."+d,d=this._self._addParamToQueryURL(d,!1,f,"email")):d=this._self.mBaseURL+"users/show/"+e+"."+d,this._self._sendRequest(d,a,b,!0,c))};
StatusnetHelper.prototype.direct_messages.inbox=function(a,b,c,d,e,f,g){d=this._self.mBaseURL+"direct_messages."+d;d=this._self._addParamToQueryURL(d,!1,e,"since");d=this._self._addParamToQueryURL(d,e,f,"since_id");d=this._self._addParamToQueryURL(d,e||f,g,"page");this._self._sendRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.direct_messages.sent=function(a,b,c,d,e,f,g){d=this._self.mBaseURL+"direct_messages/sent."+d;d=this._self._addParamToQueryURL(d,!1,e,"since");d=this._self._addParamToQueryURL(d,e,f,"since_id");d=this._self._addParamToQueryURL(d,e||f,g,"page");this._self._sendRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.direct_messages.newest=function(a,b,c,d,e,f){e?f?(d=this._self.mBaseURL+"direct_messages/new."+d,d=this._self._addParamToQueryURL(d,!1,e,"user"),d=this._self._addParamToQueryURL(d,!0,f,"text"),this._self._sendPostRequest(d,a,b,!0,c)):this._self._localizedError(this._self.mServiceName,"EmptyDMText"):this._self._localizedError(this._self.mServiceName,"EmptyDMRecipient")};
StatusnetHelper.prototype.direct_messages.destroy=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"direct_messages/destroy/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.friendships.create=function(a,b,c,d,e,f){e?(d=this._self.mBaseURL+"friendships/create/"+e+"."+d,d=this._self._addParamToQueryURL(d,!1,f,"follow"),this._self._sendPostRequest(d,a,b,!0,c)):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};StatusnetHelper.prototype.friendships.destroy=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"friendships/destroy/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.friendships.exists=function(a,b,c,d,e,f){!e||!f?this._self._localizedError(this._self.mServiceName,"MissingUserForFriendshipTest"):(d=this._self.mBaseURL+"friendships/exists."+d,d=this._self._addParamToQueryURL(d,!1,e,"user_a"),d=this._self._addParamToQueryURL(d,!0,f,"user_b"),this._self._sendRequest(d,a,b,!0,c))};
StatusnetHelper.prototype.friends.ids=function(a,b,c,d,e){this._self._sendRequest(e?this._self.mBaseURL+"friends/ids/"+e+"."+d:this._self.mBaseURL+"friends/ids."+d,a,b,!0,c)};StatusnetHelper.prototype.followers.ids=function(a,b,c,d,e){this._self._sendRequest(e?this._self.mBaseURL+"followers/ids/"+e+"."+d:this._self.mBaseURL+"followers/ids."+d,a,b,!0,c)};
StatusnetHelper.prototype.account.verify_credentials=function(a,b,c,d){this._self._sendRequest(this._self.mBaseURL+"account/verify_credentials."+d,a,b,!0,c)};StatusnetHelper.prototype.account.end_session=function(a,b,c,d){this._self._sendPostRequest(this._self.mBaseURL+"account/end_session."+d,a,b,!0,c)};
StatusnetHelper.prototype.account.update_delivery_device=function(a,b,c,d,e){"sms"!=e&&"im"!=e&&"none"!=e?this._self._localizedError(this._self.mServiceName,"WrongDevice"):(d=this._self.mBaseURL+"account/update_delivery_device."+d,d=this._self._addParamToQueryURL(d,!1,e,"device"),this._self._sendPostRequest(d,a,b,!0,c))};
StatusnetHelper.prototype.account.update_profile_colors=function(a,b,c,d,e,f,g,k,p){!e&&!f&&!g&&!k&&!p?this._self._localizedError(this._self.mServiceName,"NothingToUpdateProfileColors"):(d=this._self.mBaseURL+"account/update_profile_colors."+d,d=this._self._addParamToQueryURL(d,!1,e,"profile_background_color"),d=this._self._addParamToQueryURL(d,e,f,"profile_text_color"),d=this._self._addParamToQueryURL(d,e||f,g,"profile_link_color"),d=this._self._addParamToQueryURL(d,e||f||g,k,"profile_sidebar_fill_color"),
d=this._self._addParamToQueryURL(d,e||f||g||k,p,"profile_sidebar_border_color"),this._self._sendPostRequest(d,a,b,!0,c))};StatusnetHelper.prototype.account.rate_limit_status=function(a,b,c,d){this._self._sendRequest(this._self.mBaseURL+"account/rate_limit_status."+d,a,b,!0,c)};
StatusnetHelper.prototype.account.update_profile=function(a,b,c,d,e,f,g,k,p){d=this._self.mBaseURL+"account/update_profile."+d;d=this._self._addParamToQueryURL(d,!1,e,"name");d=this._self._addParamToQueryURL(d,e,f,"email");d=this._self._addParamToQueryURL(d,e||f,g,"url");d=this._self._addParamToQueryURL(d,e||f||g,k,"location");d=this._self._addParamToQueryURL(d,e||f||g||k,p,"description");this._self._sendPostRequest(d,a,b,!0,c)};
StatusnetHelper.prototype.favorites.favorites=function(a,b,c,d,e,f){d=e?this._self.mBaseURL+"favorites/"+e+"."+d:this._self.mBaseURL+"favorites."+d;d=this._self._addParamToQueryURL(d,!1,f,"page");this._self._sendRequest(d,a,b,!0,c)};StatusnetHelper.prototype.favorites.create=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"favorites/create/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.favorites.destroy=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"favorites/destroy/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};StatusnetHelper.prototype.notifications.follow=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"notifications/follow/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.notifications.leave=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"notifications/leave/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};StatusnetHelper.prototype.blocks.create=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"blocks/create/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};
StatusnetHelper.prototype.blocks.destroy=function(a,b,c,d,e){e?this._self._sendPostRequest(this._self.mBaseURL+"blocks/destroy/"+e+"."+d,a,b,!0,c):this._self._localizedError(this._self.mServiceName,"MissingIdParameter")};StatusnetHelper.prototype.help.test=function(a,b,c,d){this._self._sendRequest(this._self.mBaseURL+"help/test."+d,a,b,!0,c)};StatusnetHelper.prototype.isMention=function(a){a=a.match(/(@\w*)/g);for(var b=0;b<a.length;b++)if(a[b]=="@"+this.mAccount)return!0;return!1};
StatusnetHelper.prototype.hasTag=function(a,b){for(var c=a.match(/(#\w*)/g),d=0;d<c.length;d++)if(c[d]=="#"+b)return!0;return!1};Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),abbreviatedDayNames:"Sun Mon Tue Wed Thu Fri Sat".split(" "),shortestDayNames:"Su Mo Tu We Th Fr Sa".split(" "),firstLetterDayNames:"SMTWTFS".split(""),monthNames:"January February March April May June July August September October November December".split(" "),abbreviatedMonthNames:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),
amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,
may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,
second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",
MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(a){var b=Date.CultureInfo.monthNames,c=Date.CultureInfo.abbreviatedMonthNames;a=a.toLowerCase();for(var d=0;d<b.length;d++)if(b[d].toLowerCase()==a||c[d].toLowerCase()==a)return d;return-1};Date.getDayNumberFromName=function(a){var b=Date.CultureInfo.dayNames,c=Date.CultureInfo.abbreviatedDayNames;a=a.toLowerCase();for(var d=0;d<b.length;d++)if(b[d].toLowerCase()==a||c[d].toLowerCase()==a)return d;return-1};
Date.isLeapYear=function(a){return 0===a%4&&0!==a%100||0===a%400};Date.getDaysInMonth=function(a,b){return[31,Date.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]};Date.getTimezoneOffset=function(a,b){return b?Date.CultureInfo.abbreviatedTimeZoneDST[a.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[a.toUpperCase()]};
Date.getTimezoneAbbreviation=function(a,b){var c=b?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,d;for(d in c)if(c[d]===a)return d;return null};Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.compareTo=function(a){if(isNaN(this))throw Error(this);if(a instanceof Date&&!isNaN(a))return this>a?1:this<a?-1:0;throw new TypeError(a);};Date.prototype.equals=function(a){return 0===this.compareTo(a)};
Date.prototype.between=function(a,b){var c=this.getTime();return c>=a.getTime()&&c<=b.getTime()};Date.prototype.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+a);return this};Date.prototype.addSeconds=function(a){return this.addMilliseconds(1E3*a)};Date.prototype.addMinutes=function(a){return this.addMilliseconds(6E4*a)};Date.prototype.addHours=function(a){return this.addMilliseconds(36E5*a)};Date.prototype.addDays=function(a){return this.addMilliseconds(864E5*a)};
Date.prototype.addWeeks=function(a){return this.addMilliseconds(6048E5*a)};Date.prototype.addMonths=function(a){var b=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+a);this.setDate(Math.min(b,this.getDaysInMonth()));return this};Date.prototype.addYears=function(a){return this.addMonths(12*a)};
Date.prototype.add=function(a){if("number"==typeof a)return this._orient=a,this;if(a.millisecond||a.milliseconds)this.addMilliseconds(a.millisecond||a.milliseconds);if(a.second||a.seconds)this.addSeconds(a.second||a.seconds);if(a.minute||a.minutes)this.addMinutes(a.minute||a.minutes);if(a.hour||a.hours)this.addHours(a.hour||a.hours);if(a.month||a.months)this.addMonths(a.month||a.months);if(a.year||a.years)this.addYears(a.year||a.years);if(a.day||a.days)this.addDays(a.day||a.days);return this};
Date._validate=function(a,b,c,d){if("number"!=typeof a)throw new TypeError(a+" is not a Number.");if(a<b||a>c)throw new RangeError(a+" is not a valid value for "+d+".");return!0};Date.validateMillisecond=function(a){return Date._validate(a,0,999,"milliseconds")};Date.validateSecond=function(a){return Date._validate(a,0,59,"seconds")};Date.validateMinute=function(a){return Date._validate(a,0,59,"minutes")};Date.validateHour=function(a){return Date._validate(a,0,23,"hours")};
Date.validateDay=function(a,b,c){return Date._validate(a,1,Date.getDaysInMonth(b,c),"days")};Date.validateMonth=function(a){return Date._validate(a,0,11,"months")};Date.validateYear=function(a){return Date._validate(a,1,9999,"seconds")};
Date.prototype.set=function(a){!a.millisecond&&0!==a.millisecond&&(a.millisecond=-1);!a.second&&0!==a.second&&(a.second=-1);!a.minute&&0!==a.minute&&(a.minute=-1);!a.hour&&0!==a.hour&&(a.hour=-1);!a.day&&0!==a.day&&(a.day=-1);!a.month&&0!==a.month&&(a.month=-1);!a.year&&0!==a.year&&(a.year=-1);-1!=a.millisecond&&Date.validateMillisecond(a.millisecond)&&this.addMilliseconds(a.millisecond-this.getMilliseconds());-1!=a.second&&Date.validateSecond(a.second)&&this.addSeconds(a.second-this.getSeconds());
-1!=a.minute&&Date.validateMinute(a.minute)&&this.addMinutes(a.minute-this.getMinutes());-1!=a.hour&&Date.validateHour(a.hour)&&this.addHours(a.hour-this.getHours());-1!==a.month&&Date.validateMonth(a.month)&&this.addMonths(a.month-this.getMonth());-1!=a.year&&Date.validateYear(a.year)&&this.addYears(a.year-this.getFullYear());-1!=a.day&&Date.validateDay(a.day,this.getFullYear(),this.getMonth())&&this.addDays(a.day-this.getDate());a.timezone&&this.setTimezone(a.timezone);a.timezoneOffset&&this.setTimezoneOffset(a.timezoneOffset);
return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.isLeapYear=function(){var a=this.getFullYear();return 0===a%4&&0!==a%100||0===a%400};Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})};
Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})};Date.prototype.moveToDayOfWeek=function(a,b){var c=(a-this.getDay()+7*(b||1))%7;return this.addDays(0===c?c+7*(b||1):c)};Date.prototype.moveToMonth=function(a,b){var c=(a-this.getMonth()+12*(b||1))%12;return this.addMonths(0===c?c+12*(b||1):c)};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864E5)};
Date.prototype.getWeekOfYear=function(a){var b=this.getFullYear(),c=this.getMonth(),d=this.getDate();a=a||Date.CultureInfo.firstDayOfWeek;var e=8-(new Date(b,0,1)).getDay();8==e&&(e=1);c=(Date.UTC(b,c,d,0,0,0)-Date.UTC(b,0,1,0,0,0))/864E5+1;c=Math.floor((c-e+7)/7);c===a&&(b--,b=8-(new Date(b,0,1)).getDay(),c=2==b||8==b?53:52);return c};Date.prototype.isDST=function(){console.log("isDST");return"D"==this.toString().match(/(E|C|M|P)(S|D)T/)[2]};
Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())};Date.prototype.setTimezoneOffset=function(a){var b=this.getTimezoneOffset();this.addMinutes(-6*Number(a)/10-b);return this};Date.prototype.setTimezone=function(a){return this.setTimezoneOffset(Date.getTimezoneOffset(a))};Date.prototype.getUTCOffset=function(){var a=-10*this.getTimezoneOffset()/6;if(0>a)return a=(a-1E4).toString(),a[0]+a.substr(2);a=(a+1E4).toString();return"+"+a.substr(1)};
Date.prototype.getDayName=function(a){return a?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]};Date.prototype.getMonthName=function(a){return a?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]};Date.prototype._toString=Date.prototype.toString;
Date.prototype.toString=function(a){var b=this,c=function(a){return 1==a.toString().length?"0"+a:a};return a?a.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(a){switch(a){case "hh":return c(13>b.getHours()?b.getHours():b.getHours()-12);case "h":return 13>b.getHours()?b.getHours():b.getHours()-12;case "HH":return c(b.getHours());case "H":return b.getHours();case "mm":return c(b.getMinutes());case "m":return b.getMinutes();case "ss":return c(b.getSeconds());case "s":return b.getSeconds();
case "yyyy":return b.getFullYear();case "yy":return b.getFullYear().toString().substring(2,4);case "dddd":return b.getDayName();case "ddd":return b.getDayName(!0);case "dd":return c(b.getDate());case "d":return b.getDate().toString();case "MMMM":return b.getMonthName();case "MMM":return b.getMonthName(!0);case "MM":return c(b.getMonth()+1);case "M":return b.getMonth()+1;case "t":return 12>b.getHours()?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case "tt":return 12>
b.getHours()?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case "zzz":case "zz":case "z":return""}}):this._toString()};Date.now=function(){return new Date};Date.today=function(){return Date.now().clearTime()};Date.prototype._orient=1;Date.prototype.next=function(){this._orient=1;return this};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this};Date.prototype._is=!1;Date.prototype.is=function(){this._is=!0;return this};
Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var a={};a[this._dateElement]=this;return Date.now().add(a)};Number.prototype.ago=function(){var a={};a[this._dateElement]=-1*this;return Date.now().add(a)};
(function(){for(var a=Date.prototype,b=Number.prototype,c="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),d="january february march april may june july august september october november december".split(/\s/),e="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),f=function(a){return function(){return this._is?(this._is=!1,this.getDay()==a):this.moveToDayOfWeek(a,this._orient)}},g=0;g<c.length;g++)a[c[g]]=a[c[g].substring(0,3)]=f(g);c=function(a){return function(){return this._is?
(this._is=!1,this.getMonth()===a):this.moveToMonth(a,this._orient)}};for(f=0;f<d.length;f++)a[d[f]]=a[d[f].substring(0,3)]=c(f);c=function(a){return function(){"s"!=a.substring(a.length-1)&&(a+="s");return this["add"+a](this._orient)}};f=function(a){return function(){this._dateElement=a;return this}};for(g=0;g<e.length;g++)d=e[g].toLowerCase(),a[d]=a[d+"s"]=c(e[g]),b[d]=b[d+"s"]=f(d)})();Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")};
Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)};
Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};
(function(){Date.Parsing={Exception:function(a){this.message="Parse error at '"+a.substring(0,10)+" ...'"}};for(var a=Date.Parsing,b=a.Operators={rtoken:function(b){return function(c){var d=c.match(b);if(d)return[d[0],c.substring(d[0].length)];throw new a.Exception(c);}},token:function(a){return function(a){return b.rtoken(RegExp("^s*"+a+"s*"))(a)}},stoken:function(a){return b.rtoken(RegExp("^"+a))},until:function(a){return function(b){for(var c=[],d=null;b.length;){try{d=a.call(this,b)}catch(e){c.push(d[0]);
b=d[1];continue}break}return[c,b]}},many:function(a){return function(b){for(var c=[],d=null;b.length;){try{d=a.call(this,b)}catch(e){break}c.push(d[0]);b=d[1]}return[c,b]}},optional:function(a){return function(b){var c=null;try{c=a.call(this,b)}catch(d){return[null,b]}return[c[0],c[1]]}},not:function(b){return function(c){try{b.call(this,c)}catch(d){return[null,c]}throw new a.Exception(c);}},ignore:function(a){return a?function(b){var c=null,c=a.call(this,b);return[null,c[1]]}:null},product:function(){for(var a=
arguments[0],c=Array.prototype.slice.call(arguments,1),d=[],e=0;e<a.length;e++)d.push(b.each(a[e],c));return d},cache:function(b){var c={},d=null;return function(e){try{d=c[e]=c[e]||b.call(this,e)}catch(h){d=c[e]=h}if(d instanceof a.Exception)throw d;return d}},any:function(){var b=arguments;return function(c){for(var d=null,e=0;e<b.length;e++)if(null!=b[e]){try{d=b[e].call(this,c)}catch(h){d=null}if(d)return d}throw new a.Exception(c);}},each:function(){var b=arguments;return function(c){for(var d=
[],e=null,h=0;h<b.length;h++)if(null!=b[h]){try{e=b[h].call(this,c)}catch(l){throw new a.Exception(c);}d.push(e[0]);c=e[1]}return[d,c]}},all:function(){var a=a;return a.each(a.optional(arguments))},sequence:function(c,d,e){d=d||b.rtoken(/^\s*/);e=e||null;return 1==c.length?c[0]:function(b){for(var h=null,l=null,q=[],m=0;m<c.length;m++){try{h=c[m].call(this,b)}catch(n){break}q.push(h[0]);try{l=d.call(this,h[1])}catch(s){l=null;break}b=l[1]}if(!h)throw new a.Exception(b);if(l)throw new a.Exception(l[1]);
if(e)try{h=e.call(this,h[1])}catch(t){throw new a.Exception(h[1]);}return[q,h?h[1]:b]}},between:function(a,c,d){d=d||a;var e=b.each(b.ignore(a),c,b.ignore(d));return function(a){a=e.call(this,a);return[[a[0][0],r[0][2]],a[1]]}},list:function(a,c,d){c=c||b.rtoken(/^\s*/);d=d||null;return a instanceof Array?b.each(b.product(a.slice(0,-1),b.ignore(c)),a.slice(-1),b.ignore(d)):b.each(b.many(b.each(a,b.ignore(c))),px,b.ignore(d))},set:function(c,d,e){d=d||b.rtoken(/^\s*/);e=e||null;return function(p){for(var h=
null,l=h=null,q=null,m=[[],p],n=!1,s=0;s<c.length;s++){h=l=null;n=1==c.length;try{h=c[s].call(this,p)}catch(t){continue}q=[[h[0]],h[1]];if(0<h[1].length&&!n)try{l=d.call(this,h[1])}catch(u){n=!0}else n=!0;!n&&0===l[1].length&&(n=!0);if(!n){h=[];for(n=0;n<c.length;n++)s!=n&&h.push(c[n]);h=b.set(h,d).call(this,l[1]);0<h[0].length&&(q[0]=q[0].concat(h[0]),q[1]=h[1])}q[1].length<m[1].length&&(m=q);if(0===m[1].length)break}if(0===m[0].length)return m;if(e){try{l=e.call(this,m[1])}catch(v){throw new a.Exception(m[1]);
}m[1]=l[1]}return m}},forward:function(a,b){return function(c){return a[b].call(this,c)}},replace:function(a,b){return function(c){c=a.call(this,c);return[b,c[1]]}},process:function(a,b){return function(c){c=a.call(this,c);return[b.call(this,c[0]),c[1]]}},min:function(b,c){return function(d){var e=c.call(this,d);if(e[0].length<b)throw new a.Exception(d);return e}}},c=function(a){return function(){var b=null,c=[];1<arguments.length?b=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&
(b=arguments[0]);if(b)for(var d=b.shift();0<d.length;)return b.unshift(d[0]),c.push(a.apply(null,b)),b.shift(),c;else return a.apply(null,arguments)}},d="optional not ignore cache".split(/\s/),e=0;e<d.length;e++)b[d[e]]=c(b[d[e]]);c=function(a){return function(){return arguments[0]instanceof Array?a.apply(null,arguments[0]):a.apply(null,arguments)}};d="each any all".split(/\s/);for(e=0;e<d.length;e++)b[d[e]]=c(b[d[e]])})();
(function(){var a=function(b){for(var c=[],d=0;d<b.length;d++)b[d]instanceof Array?c=c.concat(a(b[d])):b[d]&&c.push(b[d]);return c};Date.Grammar={};Date.Translator={hour:function(a){return function(){this.hour=Number(a)}},minute:function(a){return function(){this.minute=Number(a)}},second:function(a){return function(){this.second=Number(a)}},meridian:function(a){return function(){this.meridian=a.slice(0,1).toLowerCase()}},timezone:function(a){return function(){var b=a.replace(/[^\d\+\-]/g,"");b.length?
this.timezoneOffset=Number(b):this.timezone=a.toLowerCase()}},day:function(a){var b=a[0];return function(){this.day=Number(b.match(/\d+/)[0])}},month:function(a){return function(){this.month=3==a.length?Date.getMonthNumberFromName(a):Number(a)-1}},year:function(a){return function(){var b=Number(a);this.year=2<a.length?b:b+(b+2E3<Date.CultureInfo.twoDigitYearMax?2E3:1900)}},rday:function(a){return function(){switch(a){case "yesterday":this.days=-1;break;case "tomorrow":this.days=1;break;case "today":this.days=
0;break;case "now":this.days=0,this.now=!0}}},finishExact:function(a){a=a instanceof Array?a:[a];var b=new Date;this.year=b.getFullYear();this.month=b.getMonth();this.day=1;for(b=this.second=this.minute=this.hour=0;b<a.length;b++)a[b]&&a[b].call(this);this.hour="p"==this.meridian&&13>this.hour?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");a=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);
this.timezone?a.set({timezone:this.timezone}):this.timezoneOffset&&a.set({timezoneOffset:this.timezoneOffset});return a},finish:function(b){b=b instanceof Array?a(b):[b];if(0===b.length)return null;for(var c=0;c<b.length;c++)"function"==typeof b[c]&&b[c].call(this);if(this.now)return new Date;b=Date.today();if(null!=this.days||this.orient||this.operator){var d,e;e="past"==this.orient||"subtract"==this.operator?-1:1;this.weekday&&(this.unit="day",c=Date.getDayNumberFromName(this.weekday)-b.getDay(),
d=7,this.days=c?(c+e*d)%d:e*d);this.month&&(this.unit="month",c=this.month-b.getMonth(),d=12,this.months=c?(c+e*d)%d:e*d,this.month=null);this.unit||(this.unit="day");if(null==this[this.unit+"s"]||null!=this.operator)this.value||(this.value=1),"week"==this.unit&&(this.unit="day",this.value*=7),this[this.unit+"s"]=this.value*e;return b.add(this)}this.meridian&&this.hour&&(this.hour=13>this.hour&&"p"==this.meridian?this.hour+12:this.hour);this.weekday&&!this.day&&(this.day=b.addDays(Date.getDayNumberFromName(this.weekday)-
b.getDay()).getDate());this.month&&!this.day&&(this.day=1);return b.set(this)}};var b=Date.Parsing.Operators,c=Date.Grammar,d=Date.Translator,e;c.datePartDelimiter=b.rtoken(/^([\s\-\.\,\/\x27]+)/);c.timePartDelimiter=b.stoken(":");c.whiteSpace=b.rtoken(/^\s*/);c.generalDelimiter=b.rtoken(/^(([\s\,]|at|on)+)/);var f={};c.ctoken=function(a){var c=f[a];if(!c){for(var c=Date.CultureInfo.regexPatterns,d=a.split(/\s+/),e=[],g=0;g<d.length;g++)e.push(b.replace(b.rtoken(c[d[g]]),d[g]));c=f[a]=b.any.apply(null,
e)}return c};c.ctoken2=function(a){return b.rtoken(Date.CultureInfo.regexPatterns[a])};c.h=b.cache(b.process(b.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),d.hour));c.hh=b.cache(b.process(b.rtoken(/^(0[0-9]|1[0-2])/),d.hour));c.H=b.cache(b.process(b.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),d.hour));c.HH=b.cache(b.process(b.rtoken(/^([0-1][0-9]|2[0-3])/),d.hour));c.m=b.cache(b.process(b.rtoken(/^([0-5][0-9]|[0-9])/),d.minute));c.mm=b.cache(b.process(b.rtoken(/^[0-5][0-9]/),d.minute));c.s=b.cache(b.process(b.rtoken(/^([0-5][0-9]|[0-9])/),
d.second));c.ss=b.cache(b.process(b.rtoken(/^[0-5][0-9]/),d.second));c.hms=b.cache(b.sequence([c.H,c.mm,c.ss],c.timePartDelimiter));c.t=b.cache(b.process(c.ctoken2("shortMeridian"),d.meridian));c.tt=b.cache(b.process(c.ctoken2("longMeridian"),d.meridian));c.z=b.cache(b.process(b.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),d.timezone));c.zz=b.cache(b.process(b.rtoken(/^(\+|\-)\s*\d\d\d\d/),d.timezone));c.zzz=b.cache(b.process(c.ctoken2("timezone"),d.timezone));c.timeSuffix=b.each(b.ignore(c.whiteSpace),b.set([c.tt,
c.zzz]));c.time=b.each(b.optional(b.ignore(b.stoken("T"))),c.hms,c.timeSuffix);c.d=b.cache(b.process(b.each(b.rtoken(/^([0-2]\d|3[0-1]|\d)/),b.optional(c.ctoken2("ordinalSuffix"))),d.day));c.dd=b.cache(b.process(b.each(b.rtoken(/^([0-2]\d|3[0-1])/),b.optional(c.ctoken2("ordinalSuffix"))),d.day));c.ddd=c.dddd=b.cache(b.process(c.ctoken("sun mon tue wed thu fri sat"),function(a){return function(){this.weekday=a}}));c.M=b.cache(b.process(b.rtoken(/^(1[0-2]|0\d|\d)/),d.month));c.MM=b.cache(b.process(b.rtoken(/^(1[0-2]|0\d)/),
d.month));c.MMM=c.MMMM=b.cache(b.process(c.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),d.month));c.y=b.cache(b.process(b.rtoken(/^(\d\d?)/),d.year));c.yy=b.cache(b.process(b.rtoken(/^(\d\d)/),d.year));c.yyy=b.cache(b.process(b.rtoken(/^(\d\d?\d?\d?)/),d.year));c.yyyy=b.cache(b.process(b.rtoken(/^(\d\d\d\d)/),d.year));e=function(){return b.each(b.any.apply(null,arguments),b.not(c.ctoken2("timeContext")))};c.day=e(c.d,c.dd);c.month=e(c.M,c.MMM);c.year=e(c.yyyy,c.yy);c.orientation=b.process(c.ctoken("past future"),
function(a){return function(){this.orient=a}});c.operator=b.process(c.ctoken("add subtract"),function(a){return function(){this.operator=a}});c.rday=b.process(c.ctoken("yesterday tomorrow today now"),d.rday);c.unit=b.process(c.ctoken("minute hour day week month year"),function(a){return function(){this.unit=a}});c.value=b.process(b.rtoken(/^\d\d?(st|nd|rd|th)?/),function(a){return function(){this.value=a.replace(/\D/g,"")}});c.expression=b.set([c.rday,c.operator,c.value,c.unit,c.orientation,c.ddd,
c.MMM]);e=function(){return b.set(arguments,c.datePartDelimiter)};c.mdy=e(c.ddd,c.month,c.day,c.year);c.ymd=e(c.ddd,c.year,c.month,c.day);c.dmy=e(c.ddd,c.day,c.month,c.year);c.date=function(a){return(c[Date.CultureInfo.dateElementOrder]||c.mdy).call(this,a)};c.format=b.process(b.many(b.any(b.process(b.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(a){if(c[a])return c[a];throw Date.Parsing.Exception(a);}),b.process(b.rtoken(/^[^dMyhHmstz]+/),function(a){return b.ignore(b.stoken(a))}))),
function(a){return b.process(b.each.apply(null,a),d.finishExact)});var g={};c.formats=function(a){if(a instanceof Array){for(var d=[],e=0;e<a.length;e++)d.push(g[a[e]]=g[a[e]]||c.format(a[e])[0]);return b.any.apply(null,d)}return g[a]=g[a]||c.format(a)[0]};c._formats=c.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);c._start=b.process(b.set([c.date,c.time,c.expression],c.generalDelimiter,c.whiteSpace),d.finish);c.start=function(a){try{var b=c._formats.call({},
a);if(0===b[1].length)return b}catch(d){}return c._start.call({},a)}})();Date._parse=Date.parse;Date.parse=function(a){var b=null;if(!a)return null;try{b=Date.Grammar.start.call({},a)}catch(c){return null}return 0===b[1].length?b[0]:null};Date.getParseFunction=function(a){var b=Date.Grammar.formats(a);return function(a){var d=null;try{d=b.call({},a)}catch(e){return null}return 0===d[1].length?d[0]:null}};Date.parseExact=function(a,b){return Date.getParseFunction(b)(a)};function custom_tssg_event(a,b,c,d,e,f){this.event_title=a;this.event_description=b;this.event_date=c;this.event_start_time=d;this.event_end_time=e;this.event_location=f}
var Eventherald={snh:null,stash:null,eventId:null,byp:0,validateLoginDetails:function(a,b){var c=!0;if(0===a.length||0===b.length)c=!1;return c},connectToSN:function(a,b,c){console.log("Connecting to SN ...");Eventherald.validateLoginDetails(a,b)?(Eventherald.snh=new StatusnetHelper(a,b,null,c),jQuery("#loginStatus").text("Connecting to SN ..."),Eventherald.snh.account.verify_credentials(Eventherald.loggedIn,Eventherald.loginFailed,c,"json")):Eventherald.loginFailed(Eventherald.snh,null,"You need to provide authentication (username and password) details.",
null)},loggedIn:function(a,b,c){console.log("Login succeeded");jQuery("#loginStatus").text("");window.localStorage&&(localStorage.setItem("eh.username",a.mAccount),localStorage.setItem("eh.userpass",a.mPassword),localStorage.setItem("eh.userdomain",c));jQuery.mobile.changePage(jQuery("#main"))},loginFailed:function(a,b,c,d){console.log("Login failed for identity");Eventherald.snh=null;c?jQuery("#loginStatus").text(c):jQuery("#loginStatus").text("Login failed. Please try again.")},isConnected:function(){return null===
Eventherald.snh?!1:!0},start:function(){if(Eventherald.isConnected())jQuery.mobile.changePage(jQuery("#main"));else if(jQuery.mobile.changePage(jQuery("#login")),window.localStorage){var a=localStorage.getItem("eh.username"),b=localStorage.getItem("eh.userpass"),c=localStorage.getItem("eh.userdomain");a&&(b&&c)&&Eventherald.connectToSN(a,b,c)}},toCTE:function(a){return a&&a.annotations&&0<a.annotations.length&&a.annotations[0].custom_tssg_event?a.annotations[0].custom_tssg_event:{}},cleanText:function(a){return a.replace("#event",
"")},bypass:function(a){if(3<Eventherald.byp)return!0;Eventherald.byp++;a.preventDefault();console.log("Bypass:"+Eventherald.byp);return!1},getTimestamp:function(a){if(!a)return 0;a.ts||(a.event_date?(a.ts=a.event_start_time?(new Date(a.event_date+" "+a.event_start_time)).getTime():(new Date(a.event_date)).getTime(),a.ts||(console.log("Wrong date format!!"),a.ts=0)):a.ts=0);return a.ts},indexOf:function(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b)return c;return-1},eventSorter:function(a,b){var c=
Eventherald.getTimestamp(Eventherald.toCTE(a)),d=Eventherald.getTimestamp(Eventherald.toCTE(b));return c-d},eventsRetrievalError:function(a,b,c,d){console.log("upcomingEvents:Retrieval failed");jQuery("#upcomingEventsContent").html('<li data-role="list-divider" data-theme="a">'+c+"</li>");jQuery("#upcomingEventsContent").listview("refresh")},eventsRetrievalSuccess:function(a,b,c){console.log("upcomingEvents: Got:"+b.length+" events.");c=a="";for(var d=3<b.length?Math.floor(b.length/2)-1:4,e=0;e<b.length;e++){a=
a+'<li><a href="#eventdetail" onclick="Eventherald.eventId='+b[e].id+'"><h1>';var f=Eventherald.toCTE(b[e]);a=f.event_title?a+f.event_title:a+"Event "+b[e].id;a=a+"</h1><p>"+Eventherald.cleanText(b[e].text)+"</p></a></li>";e===d&&(c=a,a="")}jQuery("#upcomingEventsContent").html(c).listview("refresh");jQuery("#upcomingEventsContent1").html(a).listview("refresh");Eventherald.stash=b},getUpcomingEvents:function(a){!0===Eventherald.isConnected()?(console.log("Getting upcoming events ..."),jQuery("upcomingEventsContent").html('<li data-role="list-divider">Getting upcoming events ...</li>'),
jQuery("#upcomingEventsContent").listview("refresh"),Eventherald.snh.statuses.public_timeline(Eventherald.eventsRetrievalSuccess,Eventherald.eventsRetrievalError,"upcomingEvents","json",null)):Eventherald.eventsRetrievalError(null,null,"You need to login to get events","upcomingEvents")},getCurrentEvent:function(){for(var a=Eventherald.stash?Eventherald.stash.length:0,b=0;b<a;b++)if(Eventherald.stash[b].id===Eventherald.eventId)return Eventherald.stash[b];return null},getAttendingEvent:function(){for(var a=
Eventherald.getAttendingEvents(),b=0;b<a.length;b++)if(a[b].id===Eventherald.eventId)return a[b];return null},renderEventDetails:function(a){var b=Eventherald.getCurrentEvent();null===b&&(b=Eventherald.getAttendingEvent());if(null!==b){var c=Eventherald.toCTE(b);a=c.event_title?c.event_title:"none";jQuery("#eventDetailTitle").text(a);a='<tr><td rowspan="3">';b.user.profile_image_url&&(a=a+'<img src="'+b.user.profile_image_url+'"/>');a+='</td><td width="20%"><p>Attending:</p></td><td>';a=b.favourite_count?
a+b.favourite_count:a+"unknown";a+="</td></tr><tr><td><p>When:</p></td><td>";c.event_date?(a+=c.event_date,c.event_start_time&&(a=a+" at "+c.event_start_time)):a+="not specified";a+="</td></tr><tr><td><p>Location:</p></td><td>";a=c.event_location?a+c.event_location:a+"not available";a+="</td></tr><tr><td>&nbsp;";a+='</td></tr><tr><td>More info:</td><td colspan="2">';a=c.event_description?a+c.event_description:a+Eventherald.cleanText(b.text);a+="</td></tr>";Eventherald.isAttending(b.id)?(jQuery("#eventDetailStatus").text("Attending this event"),
jQuery("#attendEvent .ui-btn-text").text("Cant attend")):(jQuery("#eventDetailStatus").html("<br/>"),jQuery("#attendEvent .ui-btn-text").text("Attend"))}else console.log("No event detail for "+Eventherald.eventId),a="<tr><td>No details</td><td>Retrieval failed.</td></tr>",jQuery("#eventDetailStatus").html("<br/>");jQuery("#eventDetailContent").html(a)},eventDetailError:function(a,b,c,d){console.log(d+":"+c);c||(c="Failed to update, try again later.");jQuery("#eventDetailStatus").text(c)},likeSuccess:function(a,
b,c){console.log("Liked event"+c);jQuery("#eventDetailStatus").text("Interested in this event")},likeEvent:function(){var a=Eventherald.getCurrentEvent();null===a&&(a=Eventherald.getAttendingEvent());null!==a?(a=a.id,!0===Eventherald.isConnected()?(console.log("likeEvent: Liking this event ..."),jQuery("#eventDetailStatus").text("Like this event ..."),Eventherald.snh.statuses.update(Eventherald.likeSuccess,Eventherald.eventDetailError,"likeEvent","json","#interesting Interesting",a,"eventherald")):
Eventherald.eventDetailError(null,null,"You need to login to like events.","likeEvent")):Eventherald.eventDetailError(null,null,"Could not find this event "+Eventherald.eventId,"likeEvent")},getAttendingEvents:function(){var a;window.localStorage&&(a=localStorage.getItem("micheal.attending"));return null===a?[]:JSON.parse(a)},addAttendingEvent:function(a){if(window.localStorage){var b=Eventherald.getAttendingEvents(),c=Eventherald.toCTE(a),d=Eventherald.getTimestamp(c);console.log("attendEvent: "+
a.id+" on "+c.event_date+" at "+c.event_start_time+", ts:"+d);a=b.push(a);b=b.sort(Eventherald.eventSorter);console.log("Now attending "+a+" events.");localStorage.setItem("micheal.attending",JSON.stringify(b))}else console.log("Nothing added")},removeAttendingEvent:function(a){if(window.localStorage){var b=Eventherald.getAttendingEvents(),c=Eventherald.indexOf(b,a);if(0<=c)return b.splice(c,1),console.log("Now attending "+b.length+" events."),localStorage.setItem("micheal.attending",JSON.stringify(b)),
!0;console.log("Nothing removed as no event id "+a)}else console.log("Nothing removed");return!1},isAttending:function(a){return-1<Eventherald.indexOf(Eventherald.getAttendingEvents(),a)?!0:!1},attendSuccess:function(a,b,c){a=Eventherald.getCurrentEvent();null!==a?(console.log("Attending event "+a.id),Eventherald.addAttendingEvent(a),jQuery("#eventDetailStatus").text("Attending this event"),jQuery("#attendEvent span").text("Cant attend")):(console.log("Invalid event id."+Eventherald.eventId),jQuery("#eventDetailStatus").text("Oops, could not find this event"))},
attendCancel:function(a,b,c){console.log("Cancelling event attendance for "+Eventherald.eventId);Eventherald.removeAttendingEvent(Eventherald.eventId)?(jQuery("#eventDetailStatus").text("Attendance cancelled"),jQuery("#attendEvent span").text("Attend")):jQuery("#eventDetailStatus").text("Oops, could not find this event")},attendEvent:function(){var a=Eventherald.eventId;!0===Eventherald.isConnected()?Eventherald.isAttending(a)?(console.log("Cancelling attendance ..."),jQuery("#eventDetailStatus").text("Cancelling attendance ..."),
Eventherald.snh.statuses.update(Eventherald.attendCancel,Eventherald.eventDetailError,"notattendingEvent","json","Cant make it. #notattending",a,"eventherald")):(console.log("Attending event ..."),jQuery("#eventDetailStatus").text("Attending event ..."),Eventherald.snh.statuses.update(Eventherald.attendSuccess,Eventherald.eventDetailError,"attendingEvent","json","See you there. #attending",a,"eventherald")):Eventherald.eventDetailError(null,null,"You need to login to alter attendance.","attendEvent")},
renderMenu:function(){var a=Eventherald.stash?Eventherald.stash.length:"refresh";jQuery("#upcomingCount").text(a);a=Eventherald.getAttendingEvents();jQuery("#attendingCount").text(a.length)},fromNow:function(a){a=(a.ts-(new Date).getTime())/1E3;var b=Math.floor(a/86400);if(!isNaN(b))return 0>b?"over":0>a?0===b&&(-60<a&&"now"||-120<a&&"1 min ago"||-3600<a&&Math.floor(a/60)+" mins ago"||-7200<a&&"1 hour ago"||-86400<a&&Math.floor(a/3600)+" hours ago"):0===b&&(60>a&&"now"||120>a&&"in 1 min"||3600>a&&
"in "+Math.floor(a/60)+" mins"||7200>a&&"in 1 hour"||86400>a&&Math.floor(a/3600)+" hours")||1===b&&"Tomorrow"||7>b&&b+" days"||31>b&&Math.ceil(b/7)+" weeks"||b&&"next month"},renderAttendingEvents:function(){console.log("Rendering attending events ...");var a=Eventherald.getAttendingEvents(),b="";if(0<a.length)for(var c=0;c<a.length;++c){var b=b+'<li class="plt"><a href="#eventdetail" onclick="Eventherald.eventId='+a[c].id+'"><h1>',d=Eventherald.toCTE(a[c]);console.log("Event"+a[c].id+":"+d.event_title+
","+d.event_date+","+d.event_start_time+",ts "+d.ts);b=d.event_title?b+d.event_title:b+"Event "+a[c].id;b+="</h1><p>";d.event_description&&(b=b+" "+d.event_description);b+='</p><span class="ui-li-aside">';d.event_date&&d.event_start_time&&(b+=Eventherald.fromNow(d));b+="</span></a></li>"}else console.log("getAttendingEvents: No events"),b='<li data-role="list-divider" >Attending no events</li>';jQuery("#attendingEventsContent").html(b).listview("refresh");$(".plt").bind("swipe",Eventherald.swipeToRemove)},
proposeError:function(a,b,c,d){console.log(d+": "+c);c||(c="Proposing the event failed, try again later.");jQuery("#proposeEventStatus").text(c)},proposeSuccess:function(a,b,c){console.log("proposeEvent: Success "+b.id);jQuery("#newEventTitle").val("");jQuery("#newEventDesc").val("");jQuery("#newEventWhen").val("");jQuery("#newEventDate").val("");jQuery("#newEventStart").val("");jQuery("#proposeEventStatus").text("Event proposed .... do you want to create another?")},proposeEvent:function(){var a=
"",b=jQuery("#newEventTitle").val();0===b.length&&(a+="an event title, ");var c=jQuery("#newEventDesc").val();0===c.length&&(a+="an event description, ");var d,e,f,g=jQuery("#newEventWhen"),k=jQuery("#newEventEnd").val();0<g.val().length?(d=Date.parse(g.val()),null!==d?(e=d.toString("yyyy/MM/dd"),f=d.toString("HH:mm"),d=d.addMinutes(k).toString("HH:mm")):(e=jQuery("#newEventDate").val(),f=jQuery("#newEventStart").val(),d=Date.parse(e+" "+f),null!==d?(d=d.addMinutes(k),d=d.toString("HH:mm")):d="")):
a+="an event date and time, ";console.log("proposeEvent:"+c+" starting at "+f+" on "+e+". Finished at "+d);0<a.length?Eventherald.proposeError(null,null,"Missing "+a+"please correct and retry.","proposeEvent"):!0===Eventherald.isConnected()?(a=new custom_tssg_event(b,c,e,f,d,null),console.log("Proposing ..."),jQuery("#proposeEventStatus").text("Proposing ..."),Eventherald.snh.statuses.aupdate(Eventherald.proposeSuccess,Eventherald.proposeError,"proposeEvent","json","#event"+b,null,"eventherald",a)):
Eventherald.proposeError(null,null,"You need to login to be able to propose events","proposeEvent")},autocomplete:function(){var a=jQuery("#newEventWhen"),b=jQuery("#newEventParse");0<a.val().length?(a=Date.parse(a.val()),null!==a?(b.text(a.toString("dddd, MMMM dd, yyyy h:mm:ss tt")),jQuery("#newEventDate").val(a.toString("yyyy-MM-dd")).addClass("ui-disabled"),jQuery("#newEventStart").val(a.toString("HH:mm")).addClass("ui-disabled")):(b.text(" Oops ..."),jQuery("#newEventDate").val("").removeClass("ui-disabled"),
jQuery("#newEventStart").val("").removeClass("ui-disabled"))):(b.text("For example, Friday at 10am, next tuesday at 4pm"),jQuery("#newEventDate").val("").removeClass("ui-disabled"),jQuery("#newEventStart").val("").removeClass("ui-disabled"))},confirmSuccess:function(a,b,c){console.log("Confirmed event "+Eventherald.eventId);jQuery("#eventDetailStatus").text("Confirmed this event");jQuery("#confirmEvent").text("Cancel")},confirmCancel:function(a,b,c){console.log("Cancelled event "+Eventherald.eventId);
jQuery("#eventDetailStatus").text("Event cancelled");jQuery("#confirmEvent").text("Confirm")},confirmEvent:function(){var a=Eventherald.getCurrentEvent();null!==a?(a=a.id,!0===Eventherald.isConnected()?Eventherald.isAttending(a)?(console.log("Cancelling event ..."),jQuery("#eventDetailStatus").text("Cancelling event ..."),Eventherald.snh.statuses.update(Eventherald.confirmCancel,Eventherald.eventDetailError,"cancelEvent","json","Cancelling event. #event-cancel",a,"eventherald")):(console.log("Confirming event ..."),
jQuery("#eventDetailStatus").text("Confirming event ..."),Eventherald.snh.statuses.update(Eventherald.confirmSuccess,Eventherald.eventDetailError,"confirmEvent","json","Event confirmed. #event-confirm",a,"eventherald")):Eventherald.eventDetailError(null,null,"You need to login to alter confirmation status.","confirmEvent")):Eventherald.eventDetailError(null,null,"Oops, could not find this event "+Eventherald.eventId,"confirmEvent")},reverse:function(a){console.log("Back button:"+jQuery.mobile.activePage.attr("id"));
switch(jQuery.mobile.activePage.attr("id")){case "login":case "main":navigator.app.exitApp();break;case "upcomingevents":case "attendingevents":case "proposeevent":Eventherald.menu(null);break;default:navigator.app.backHistory()}},menu:function(a){console.log("Menu button:"+jQuery.mobile.activePage.attr("id"));"login"!==jQuery.mobile.activePage.attr("id")&&(navigator.app.clearHistory(),jQuery.mobile.changePage(jQuery("#main")))},onDeviceReady:function(){document.addEventListener("backbutton",Eventherald.reverse,
!1);document.addEventListener("menubutton",Eventherald.menu,!1);window.plugins.speechrecognizer.init(Eventherald.speechInitOk,null)},speechInitOk:function(){console.log("Recogniser available");jQuery("#proposeSpeak").removeClass("ui-disabled")},recogniseSpeech:function(){window.plugins.speechrecognizer?(console.log("recogniseSpeech: Firing up"),window.plugins.speechrecognizer.startRecognize(Eventherald.recogniseSuccess,Eventherald.recogniseFail,1234,1,"Please say a phrase","en-US")):console.log("recogniseSpeech: Not available")},
recogniseSuccess:function(a){var b;if(a)if(b=JSON.parse(a)){a=b.speechMatches.speechMatch;for(var c in a)alert("possible match: "+a[c])}else Eventherald.recogniseFail("Invalid JSON received"+a);else Eventherald.recogniseFail("Empty result received")},recogniseFail:function(a){console.log("recogniseFail: "+a);jQuery("#proposeStatus").text("Sorry, I didnt understand that")},swipeToRemove:function(a){a=$(this);if(a.children(".aRemoveBtn")[0])$(".aRemoveBtn").remove(),$(".swiperemove").unbind("tap click");
else{$(".swiperemove").bind("tap click",function(a){$(".aRemoveBtn").remove();$(".swiperemove").unbind("tap click");return!1});$(".aRemoveBtn").remove();var b=$("<a>Remove</a>").attr({"class":"aRemoveBtn ui-btn-up-r",id:a.attr("id")});a.prepend(b);$(".aRemoveBtn").bind("tap click",function(){event.preventDefault();var a=$(this);console.log("Cancelling event attendance for "+Eventherald.eventId);Eventherald.removeAttendingEvent(a.attr("id"));a.parent().remove()})}}};
jQuery("#splash").on("pageinit",function(){console.log("Setting up jQuery wiring");document.addEventListener("deviceready",Eventherald.onDeviceReady,!1);jQuery("#connectSN").click(function(){var a=jQuery("#username").val(),b=jQuery("#userpass").val(),c=jQuery("#userdomain").val();Eventherald.connectToSN(a,b,c)});jQuery("#main").bind("pageshow",Eventherald.renderMenu);jQuery("#upcomingevents").bind("pageshow",function(){Eventherald.stash||Eventherald.getUpcomingEvents(!1)});jQuery("#refreshUpcomingEvents").click(function(){Eventherald.getUpcomingEvents(!0)});
jQuery("#eventdetail").bind("pageshow",Eventherald.renderEventDetails);jQuery("#likeEvent").click(Eventherald.likeEvent);jQuery("#attendEvent").click(Eventherald.attendEvent);jQuery("#confirmEvent").click(Eventherald.confirmEvent);jQuery("#refreshAttendingEvents").click(Eventherald.renderAttendingEvents);jQuery("#attendingevents").bind("pageshow",Eventherald.renderAttendingEvents);jQuery("#proposeEvent").click(Eventherald.proposeEvent);jQuery("#proposeSpeak").click(Eventherald.recogniseSpeech);jQuery("#newEventWhen").on("input",
Eventherald.autocomplete);jQuery("#bypass").click(Eventherald.bypass);Eventherald.start()});
